<Window x:Class="DeviceMonitorCS.ConnectionsWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Network Connections Manager" Height="600" Width="1100" WindowStartupLocation="CenterScreen">
    <Window.Resources>
        <Style TargetType="DataGrid">
            <Setter Property="AutoGenerateColumns" Value="False"/>
            <Setter Property="CanUserAddRows" Value="False"/>
            <Setter Property="IsReadOnly" Value="True"/>
            <Setter Property="HeadersVisibility" Value="Column"/>
            <Setter Property="GridLinesVisibility" Value="Horizontal"/>
            <Setter Property="SelectionMode" Value="Single"/>
        </Style>
    </Window.Resources>
    
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Toolbar -->
        <ToolBarTray Grid.Row="0">
            <ToolBar>
                 <Button x:Name="RefreshBtn" Content="Refresh Now" Margin="5" Padding="5,2"/>
                 <CheckBox x:Name="AutoRefreshToggle" Content="Auto Refresh (2s)" IsChecked="True" VerticalAlignment="Center" Margin="10,0"/>
                 <Separator/>
                 <Button x:Name="ClearHistoryBtn" Content="Clear History" Margin="5" Padding="5,2"/>
            </ToolBar>
        </ToolBarTray>

        <TabControl Grid.Row="1" Margin="5">
            <!-- Tab 1: Active Connections -->
            <TabItem Header="Active Connections">
                <DataGrid x:Name="ActiveGrid">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="Process" Binding="{Binding ProcessName}" Width="150"/>
                        <DataGridTextColumn Header="PID" Binding="{Binding Pid}" Width="60"/>
                        <DataGridTextColumn Header="Proto" Binding="{Binding Protocol}" Width="50"/>
                        <DataGridTextColumn Header="Local Address" Binding="{Binding LocalAddress}" Width="150"/>
                        <DataGridTextColumn Header="Remote Address" Binding="{Binding RemoteAddress}" Width="150"/>
                        <DataGridTextColumn Header="State" Binding="{Binding State}" Width="100"/>
                        <DataGridTextColumn Header="Who Is" Binding="{Binding WhoIs}" Width="150"/>
                        <DataGridTextColumn Header="Duration" Binding="{Binding Duration}" Width="80"/>
                    </DataGrid.Columns>
                    <DataGrid.ContextMenu>
                        <ContextMenu>
                            <MenuItem Header="Mute This Connection" x:Name="MuteActiveCtx"/>
                            <MenuItem Header="Copy Remote IP" x:Name="CopyActiveIpCtx"/>
                        </ContextMenu>
                    </DataGrid.ContextMenu>
                </DataGrid>
            </TabItem>

            <!-- Tab 2: Historical Connections -->
            <TabItem Header="Historical Connections">
                <DataGrid x:Name="HistoryGrid">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="Process" Binding="{Binding ProcessName}" Width="150"/>
                        <DataGridTextColumn Header="PID" Binding="{Binding Pid}" Width="60"/>
                        <DataGridTextColumn Header="Proto" Binding="{Binding Protocol}" Width="50"/>
                        <DataGridTextColumn Header="Local Address" Binding="{Binding LocalAddress}" Width="150"/>
                        <DataGridTextColumn Header="Remote Address" Binding="{Binding RemoteAddress}" Width="150"/>
                        <DataGridTextColumn Header="Recorded State" Binding="{Binding State}" Width="100"/>
                        <DataGridTextColumn Header="Who Is" Binding="{Binding WhoIs}" Width="150"/>
                        <DataGridTextColumn Header="Total Duration" Binding="{Binding Duration}" Width="80"/>
                    </DataGrid.Columns>
                     <DataGrid.ContextMenu>
                        <ContextMenu>
                             <MenuItem Header="Mute This Connection" x:Name="MuteHistoryCtx"/>
                             <MenuItem Header="Copy Remote IP" x:Name="CopyHistoryIpCtx"/>
                        </ContextMenu>
                    </DataGrid.ContextMenu>
                </DataGrid>
            </TabItem>

            <!-- Tab 3: Muted Connections -->
            <TabItem Header="Muted Connections">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>
                    <TextBlock Text="Muted IP Addresses (Double click or Context Menu to Unmute)" Margin="5" FontStyle="Italic"/>
                    <ListBox Grid.Row="1" x:Name="MutedList">
                        <ListBox.ContextMenu>
                            <ContextMenu>
                                <MenuItem Header="Unmute" x:Name="UnmuteCtx"/>
                            </ContextMenu>
                        </ListBox.ContextMenu>
                    </ListBox>
                </Grid>
            </TabItem>
        </TabControl>
    </Grid>
</Window>
